<%= turbo_frame_tag "dashboard_content" do %>
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold">SoundCloud Custom Artwork</h1>

    <%= button_to "Sync Liked Songs",
                  sync_milk_admin_custom_sound_cloud_artworks_path,
                  method: :post,
                  class: "bg-orange-500 hover:bg-orange-600 text-white px-6 py-2 rounded-lg font-semibold",
                  data: { confirm: "This will fetch your liked songs from SoundCloud. Continue?" } %>
  </div>

  <% if notice %>
    <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
      <%= notice %>
    </div>
  <% end %>

  <% if alert %>
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
      <%= alert %>
    </div>
  <% end %>

  <div class="bg-white shadow-md rounded-lg overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
            Artwork
          </th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
            Track Info
          </th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
            SoundCloud ID
          </th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
            Status
          </th>
          <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
            Actions
          </th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        <% if @artworks.empty? %>
          <tr>
            <td colspan="5" class="px-6 py-4 text-center text-gray-500">
              No tracks synced yet. Click "Sync Liked Songs" to get started.
            </td>
          </tr>
        <% else %>
          <% @artworks.each do |artwork| %>
            <tr>
              <td class="px-6 py-4 whitespace-nowrap">
                <% if artwork.custom_image.attached? %>
                  <%= image_tag artwork.custom_image.variant(resize_to_limit: [100, 100]),
                                class: "h-16 w-16 object-cover rounded" %>
                <% else %>
                  <div class="h-16 w-16 bg-gray-200 rounded flex items-center justify-center">
                    <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                  </div>
                <% end %>
              </td>
              <td class="px-6 py-4">
                <div class="text-sm font-medium text-gray-900"><%= artwork.track_title %></div>
                <div class="text-sm text-gray-500"><%= artwork.track_artist %></div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                <%= artwork.soundcloud_track_id %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <% if artwork.custom_image.attached? %>
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                    Custom
                  </span>
                <% else %>
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">
                    Default
                  </span>
                <% end %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                <%= link_to "Customize",
                            customize_milk_admin_custom_sound_cloud_artwork_path(artwork),
                            class: "text-indigo-600 hover:text-indigo-900 mr-4" %>

                <% if artwork.custom_image.attached? %>
                  <%= button_to "Remove",
                                milk_admin_custom_sound_cloud_artwork_path(artwork),
                                method: :delete,
                                data: { confirm: "Remove custom artwork for #{artwork.track_title}?" },
                                class: "text-red-600 hover:text-red-900 inline" %>
                <% end %>
              </td>
            </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
  </div>

  <div class="mt-6 text-sm text-gray-600">
    <p><strong>How it works:</strong></p>
    <ul class="list-disc list-inside mt-2 space-y-1">
      <li>Click "Sync Liked Songs" to fetch your SoundCloud liked tracks</li>
      <li>Click "Customize" on any track to upload custom artwork</li>
      <li>Choose to upload a new image or select from existing song images</li>
      <li>The player will automatically use your custom artwork instead of SoundCloud's</li>
    </ul>
  </div>
<% end %>
