<%= form_with(model: [ :milk_admin, @song ], data: { turbo_frame: "dashboard_content" }) do |form| %>
  <% if form.object.errors.any? %>
        <div>
            <% form.object.errors.full_messages.each do |message|  %>
            <div class="text-red-500"><%= message %></div>
            <% end %>
        </div>
    <% end %>

  <div class="" data-controller="focal-point-picker">

    <% if song.persisted? && song.image.present? %>
      <div id="<%= dom_id(song, :image) %>"
           class="flex flex-col justify-center items-center">
          <p class="text-sm mb-2">Click on the image to set the mobile crop focal point</p>
          <div class="relative inline-block cursor-crosshair"
               data-focal-point-picker-target="picker"
               data-action="click->focal-point-picker#handleClick">
            <%= image_tag url_for(song.image),
                data: { focal_point_picker_target: "image" },
                class: "w-full max-w-2xl py-2 border-2 border-gray-600 rounded" %>
            <div data-focal-point-picker-target="marker"
                 class="absolute w-8 h-8 border-4 border-sky-500 rounded-full pointer-events-none transform -translate-x-1/2 -translate-y-1/2"
                 style="left: <%= (song.focal_point_x || 0.5) * 100 %>%; top: <%= (song.focal_point_y || 0.5) * 100 %>%;"></div>
          </div>
          <p class="text-xs mt-2">
            Focal Point: X: <span data-focal-point-picker-target="xDisplay"><%= ((song.focal_point_x || 0.5) * 100).round(1) %></span>%
            Y: <span data-focal-point-picker-target="yDisplay"><%= ((song.focal_point_y || 0.5) * 100).round(1) %></span>%
          </p>
          <%= link_to "Remove image", destroy_image_milk_admin_song_path(song), class: "border border-input-background rounded-sm bg-red-400 py-1 px-2 my-2", data: { turbo_method: :delete, turbo_confirm: "are you sure?" } %>
      </div>
    <% end %>

    <div class="rounded-md p-2">
      <div class="flex items-center my-4">
        <%= form.label :image, "Select Image" %>&nbsp;
        <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 13V8m0 8h.01M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
          <span class="text-sm">w-640 x h-640 - 100kb</span>
        </svg>
      </div>
      <%= form.file_field :image, class: "block w-full text-sm border rounded-lg cursor-pointer text-base-dark focus:outline-hidden bg-gray-100 border-gray-100" %>
    </div>
    
    <div class="rounded-md p-2">
      <div class="flex items-center my-4">
        <%= form.label :audio_file, "Select Audio File" %>&nbsp;
        <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 13V8m0 8h.01M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
        </svg>
      </div>
      <%= form.file_field :audio_file, class: "block w-full text-sm border rounded-lg cursor-pointer text-base-dark focus:outline-hidden bg-gray-100 border-gray-100" %>
    </div>

    <div class="rounded-md p-2">
      <div class="flex items-center my-4">
        <%= form.label :banner_video, "Select Banner Video (optional)" %>&nbsp;
        <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 6H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1Zm7 11-6-2V9l6-2v10Z"/>
        </svg>
        <span class="text-sm ml-2 text-gray-500">MP4 format, same dimensions as image</span>
      </div>
      <%= form.file_field :banner_video, accept: "video/mp4", class: "block w-full text-sm border rounded-lg cursor-pointer text-base-dark focus:outline-hidden bg-gray-100 border-gray-100" %>
      <% if song.persisted? && song.banner_video.attached? %>
        <p class="text-sm text-green-600 mt-2">âœ“ Video attached: <%= song.banner_video.filename %></p>
        <%= link_to "Remove video", destroy_banner_video_milk_admin_song_path(song), class: "text-sm text-red-500 hover:text-red-700 mt-1 inline-block", data: { turbo_method: :delete, turbo_confirm: "Remove banner video?" } %>
      <% end %>
    </div>

    <%= form.hidden_field :focal_point_x,
        value: song.focal_point_x || 0.5,
        data: { focal_point_picker_target: "xInput" } %>
    <%= form.hidden_field :focal_point_y,
        value: song.focal_point_y || 0.5,
        data: { focal_point_picker_target: "yInput" } %>

    <div class="border border-gray-700 rounded-md p-2 mt-1">
      <h2 class="text-xl font-medium align-middle text-center p-2"">Song Information</h2>
      <%= form.fields_for :artist do |artist_form| %>
        <div class="flex justify-between items-center my-2">
          <%= artist_form.label :name, "Artist", class: "w-52" %>
          <%= artist_form.text_field :name, class: "rounded-md border border-slate-600 bg-gray-100 text-base-dark w-full" %>
        </div>
      <% end %>
      <%= form.fields_for :album do |album_form| %>
        <div class="flex justify-between items-center my-2">
          <%= album_form.label :title, "Album", class: "w-52" %>
          <%= album_form.text_field :title, class: "rounded-md border border-slate-600 bg-gray-100 text-base-dark w-full" %>
        </div>

        <%= album_form.fields_for :genre do |genre_form| %>
          <div class="flex justify-between items-center my-2">
            <%= genre_form.label :name, "Genre", class: "w-52" %>
            <%= genre_form.text_field :name, class: "rounded-md border border-slate-600 bg-gray-100 text-base-dark w-full" %>
          </div>
        <% end %>
      <% end %>
      <div class="flex justify-between items-center my-2">
        <%= form.label :title, class: "w-52" %>
        <%= form.text_field :title, class: "rounded-md border border-slate-600 bg-gray-100 text-base-dark w-full" %>
      </div>

      <div class="my-2">
        <%= form.label :user_ids, "Assign to Users" %>
        <%= form.collection_check_boxes :user_ids, User.all, :id, :email do |b| %>
          <div class="flex items-center">
            <%= b.check_box class: "mr-2" %>
            <%= b.label %>
          </div>
        <% end %>
      </div>
    </div>

    <div class="border border-gray-700 rounded-md p-2 mt-4">
      <h2 class="text-xl font-medium align-middle text-center p-2">Attribution & Credits</h2>
      <p class="text-xs text-gray-400 text-center mb-4">Give credit to the creators</p>

      <div class="flex justify-between items-center my-2">
        <%= form.label :image_credit, "Image Artist Name", class: "w-52" %>
        <%= form.text_field :image_credit, placeholder: "e.g., Jane Doe", class: "rounded-md border border-slate-600 bg-gray-100 text-base-dark w-full" %>
      </div>

      <div class="flex justify-between items-center my-2">
        <%= form.label :image_credit_url, "Image Artist URL", class: "w-52" %>
        <%= form.url_field :image_credit_url, placeholder: "https://deviantart.com/artist", class: "rounded-md border border-slate-600 bg-gray-100 text-base-dark w-full" %>
      </div>

      <div class="flex justify-between items-center my-2">
        <%= form.label :image_license, "Image License", class: "w-52" %>
        <%= form.text_field :image_license, placeholder: "e.g., CC BY-SA 4.0, Used with permission", class: "rounded-md border border-slate-600 bg-gray-100 text-base-dark w-full" %>
      </div>

      <div class="flex justify-between items-center my-2">
        <%= form.label :audio_source, "Audio Source", class: "w-52" %>
        <%= form.text_field :audio_source, placeholder: "e.g., YouTube, SoundCloud", class: "rounded-md border border-slate-600 bg-gray-100 text-base-dark w-full" %>
      </div>

      <div class="flex justify-between items-center my-2">
        <%= form.label :audio_license, "Audio License", class: "w-52" %>
        <%= form.text_field :audio_license, placeholder: "e.g., Creative Commons, All Rights Reserved", class: "rounded-md border border-slate-600 bg-gray-100 text-base-dark w-full" %>
      </div>

      <div class="flex flex-col my-2">
        <%= form.label :additional_credits, "Additional Credits", class: "mb-1" %>
        <%= form.text_area :additional_credits, rows: 3, placeholder: "Producers, engineers, featured artists, etc.", class: "rounded-md border border-slate-600 bg-gray-100 text-base-dark w-full" %>
      </div>
    </div>

    <%= form.submit "Submit", class: "border border-gray-700 rounded-md px-6 py-2 mt-2" %>
  </div>
<% end %>